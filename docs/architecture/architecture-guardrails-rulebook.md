# Architecture Guardrails Rulebook

**Build-time architectural guardrails generated and evaluated by Codegen Blueprint.**

This document defines the complete set of architecture guardrails
that Codegen Blueprint is capable of generating and applying at build time.

> âš ï¸ **Important**
>
> This document describes the **guardrails system itself**.
> It does **not** guarantee that all guardrails are active in a given release.
> Release-level guarantees are declared separately and explicitly.

---

The goal of this document is **not** to explain ArchUnit
or teach architecture styles, but to **make explicit which architectural boundaries
are generated, how they are evaluated, and why they exist**.

> Architecture here is not documented or recommended.  
> It is **compiled into build-time feedback through generated, deterministic checks**.

---

## ðŸ“‘ Table of Contents

- [Guardrails overview](#guardrails-overview)
- [Guardrails modes](#guardrails-modes)
- [Hexagonal architecture guardrails](#hexagonal-architecture-guardrails)
- [Standard (Layered) architecture guardrails](#standard-layered-architecture-guardrails)
- [What guardrails does NOT cover](#what-guardrails-does-not-cover)
- [Generated test locations](#generated-test-locations)
- [Versioning guarantee](#versioning-guarantee)
- [Summary](#summary)

---

## Guardrails overview

**Mechanism**

* Guardrails are implemented via **generated ArchUnit tests**.
* Tests are generated based on:

  * Selected **layout** (`hexagonal` or `standard`)
  * Selected **guardrails mode** (`none`, `basic`, or `strict`)
* Rules execute automatically during:

```bash
mvn verify
```

> **Structural Assumption**
>
> Architecture guardrails are evaluated against a **deterministic package structure**
> generated by Codegen Blueprint.
> The generated source layout is not cosmetic â€” it is the **structural basis**
> on which all guardrails are defined and enforced.

**Default behavior (1.0.0 GA)**

* The CLI default guardrails mode is **`basic`**
* Architecture guardrails are **enabled by default in GA**
* `none` must be **explicitly selected** to disable guardrails

**Failure behavior**

* Any violation causes the build to **fail immediately**
* No application startup is required
* No runtime checks are involved


## Guardrails modes

### none

* No architecture tests are generated.
* No guardrails guarantees are provided.

### basic

* Lightweight but meaningful guardrails.
* Prevents the most common architectural drift.
* Suitable for teams introducing architecture incrementally.

### strict

* Comprehensive guardrails for architectural boundaries.
* Prevents structural drift and accidental coupling.
* Intended for teams that treat architecture as a **non-negotiable contract**.

---

## Hexagonal architecture guardrails

### Hexagonal â€” Basic

**Guaranteed rules**

* Application layer **must not depend on adapters**
* Bootstrap layer is a **leaf module** (no other module may depend on it)
* Inbound adapters **must not depend on outbound adapters**
* Outbound adapters **must not depend on inbound adapters**
* No cyclic dependencies between top-level packages

**Intent**

* Protects core use cases from infrastructure concerns
* Prevents accidental adapter-to-adapter coupling
* Ensures bootstrapping remains replaceable and isolated
* Detects early structural drift without enforcing full strictness

> **Hexagonal â€” Basic** is designed to stop *obvious architectural violations*  
> while keeping the entry barrier low for teams adopting executable architecture.

---

### Hexagonal â€” Strict

**Strict guardrails generate the following rules:**

---

#### Adapter direction isolation

* Inbound adapters **must not depend on outbound adapters**
* Outbound adapters **must not depend on inbound adapters**

---

#### Domain purity

* Domain may depend **only on:**

  * JDK types (`java.*`)
  * Other domain types
* No framework, adapter, or application dependencies allowed

---

#### Inbound adapter â†’ domain isolation

* Inbound adapters **must not depend on domain services** (`..domain..service..`)
* Inbound adapters **must not depend on domain outbound ports** (`..domain..port..out..`)

---

#### Application implementation isolation

* Adapters must not depend on **application implementation classes**

  * Any `..application..` type **outside** `..application..port..`

---

#### Package cycle prevention

* No cyclic dependencies between top-level packages
* No cycles inside adapter subpackages

---

#### REST boundary isolation (Spring Web only)

Enforced only when:

* `spring-boot-starter-web` is present

Rules:

* REST controllers **must not expose domain types** in:

  * Return types
  * Parameters
  * Generic signatures
* DTOs under inbound adapters must not depend on domain

---

**Rationale**

* HTTP is a public boundary
* Domain types must never leak through that boundary

--- 

## Standard (Layered) architecture guardrails

### Standard â€” Basic

**Guaranteed rules**

* Controllers **must not depend on repositories**
* Domain **must not depend on:**
  * Controllers
  * Services
  * Repositories
* No cyclic dependencies between top-level packages

**Intent**

* Prevents shortcutting the service layer
* Preserves a clear separation between delivery, orchestration, and domain logic
* Detects early structural drift without enforcing full strict layering
* Provides safe baseline guardrails for teams adopting layered architecture

> **Standard â€” Basic** focuses on preventing the most common layered-architecture violations  
> while intentionally avoiding over-constraining internal service design.

---

### Standard â€” Strict

**Strict guardrails generate the following rules:**

#### Layer dependency direction (and boundary bypass prevention)

* Controllers must not depend on repositories
* Controllers must not depend on domain services
* Services must not depend on controllers
* Repositories must not depend on services or controllers

#### Domain purity

* Domain may depend **only on:**
  * JDK types (`java.*`)
  * Other domain types

#### Package cycle prevention

* No cyclic dependencies between top-level packages

#### REST boundary isolation (Spring Web only)

Enforced only when:

* `spring-boot-starter-web` is present

Rules:

* REST controllers must not expose domain types in:
  * Return types
  * Parameters
  * Generic signatures
* Controller DTOs must not depend on domain

**Rationale**

* Controller layer is the public HTTP boundary
* Domain types must never cross that boundary
* Controllers must not bypass the service layer by invoking domain services directly

---

## What guardrails does NOT cover

The following are **explicitly out of scope**:

* Code style or formatting
* Naming conventions
* Business rule correctness
* Runtime behavior (transactions, security, performance)
* Dependency vulnerability scanning

Guardrails are **structural**, not behavioral.

---

## Generated test locations

Architecture tests are generated under:

```
src/test/java/<projectPackage>/architecture/archunit/**
```

They are:

* Deterministic
* Generated from templates
* Versioned as part of the GA contract

---

## Versioning guarantee

This guardrails scope is part of the **1.0.0 GA contract**.

Changes to these rules are treated as:

* Contract changes
* Explicit version upgrades

No silent guardrails changes are introduced within a GA line.

---

## Summary

Codegen Blueprint makes architecture **explicit by construction**:

* Architectural intent is generated, not implied
* Guardrails are executable and evaluated at build time
* Boundary drift is surfaced through fast, deterministic feedback

> When a rule is violated, the build **signals the drift immediately**.
> There are no hidden conventions, silent bypasses, or runtime surprises.
